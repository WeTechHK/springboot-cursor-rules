---
description: 定义Gradle构建文件的编码标准，包括插件配置、依赖管理、任务定义和构建优化规范
globs: **/build.gradle
layer: L4
allowedReferences: [L4]
---

# Gradle 编码约定

## 适用范围
定义Gradle构建文件的规范，管理项目依赖、插件和构建任务。

## 核心规则

### 版本要求
- Gradle ≥ 8.14
- Java 17/21 (推荐LTS)
- Spring Boot 3.x

### 项目配置
- `group`: `com.{company}` (仅公司域名)
- `version`: `0.0.1-SNAPSHOT`
- 禁止将项目名混在group中

### 必须配置的插件
- `org.springframework.boot`
- `io.spring.dependency-management`
- `java`

## build.gradle 示例

```gradle
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.0'
    id 'io.spring.dependency-management' version '1.1.4'
}

group = 'com.edu'
version = '0.0.1-SNAPSHOT'
archivesBaseName = 'sms'

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    maven {
        url 'https://maven.aliyun.com/repository/public/'
    }
    mavenCentral()
}

dependencies {
    // Spring Boot Starter
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    implementation 'org.springframework.boot:spring-boot-starter-aop'
    
    // 数据访问
    implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:3.0.3'
    runtimeOnly 'com.mysql:mysql-connector-j'
    
    // 工具类
    implementation 'cn.hutool:hutool-all:5.8.24'
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    
    // API文档
    implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.3.0'
    
    // 测试
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
}

tasks.named('test') {
    useJUnitPlatform()
}
```

## settings.gradle 规范

```gradle
rootProject.name = 'your-project-name'
```

**说明**：
- `rootProject.name`：设置项目名称（不含group部分）
- 示例：如果包路径是`com.edu.sms`，则`rootProject.name = 'sms'`
- 禁止将group名混入rootProject.name（如'com-edu-soop'）
- settings.gradle必须第一个生成，build.gradle第二个生成

## Gradle项目必需文件

```
project/
├── build.gradle              # 构建脚本（必需）
├── settings.gradle           # 项目设置（必需）
├── gradle.properties         # Gradle属性（可选）
├── gradlew                   # Unix/Mac启动脚本（必需）
├── gradlew.bat               # Windows启动脚本（必需）
└── gradle/                   # Gradle Wrapper（必需）
    └── wrapper/
        ├── gradle-wrapper.jar         # Wrapper执行器（必需）
        └── gradle-wrapper.properties  # Wrapper配置（必需）
```

## Gradle Wrapper 完整性要求

### AI生成时必须创建
1. ✅ `settings.gradle` - 项目设置
2. ✅ `build.gradle` - 构建配置
3. ✅ `gradle/wrapper/gradle-wrapper.properties` - Wrapper配置文件
4. ✅ `gradlew` - Unix/Mac可执行脚本
5. ✅ `gradlew.bat` - Windows可执行脚本

### gradle-wrapper.jar 自动化下载

**优先自动下载**：
```bash
# 方式1：直接下载（推荐）
curl -L -o gradle/wrapper/gradle-wrapper.jar \
  https://github.com/gradle/gradle/raw/v8.10.2/gradle/wrapper/gradle-wrapper.jar

# 方式2：使用系统Gradle（如果已安装）
gradle wrapper --gradle-version=8.10.2
```

**如果自动下载失败，提示用户手动完成**：
```markdown
⚠️  自动下载 gradle-wrapper.jar 失败，请选择以下方式之一完成：

方式1：使用 IntelliJ IDEA（最简单）
- 用 IDEA 打开项目
- IDEA 会自动检测并下载缺失的 gradle-wrapper.jar

方式2：手动下载
- 执行: curl -L -o gradle/wrapper/gradle-wrapper.jar \
  https://github.com/gradle/gradle/raw/v8.10.2/gradle/wrapper/gradle-wrapper.jar

方式3：使用系统 Gradle
- 安装: brew install gradle
- 执行: gradle wrapper --gradle-version=8.10.2
```

## 禁止行为

1. ❌ 禁止同时生成`pom.xml`和`build.gradle`
2. ❌ 禁止只生成`build.gradle`而不生成`settings.gradle`
3. ❌ 禁止在group中包含项目名（如`group = 'com.edu.soop'`应为`group = 'com.edu'`）
4. ❌ 禁止生成不完整的Wrapper（至少要有properties和gradlew脚本）
5. ❌ 禁止gradlew脚本参数传递错误

## 相关规则
本规则为L4层具体约定，已内化上层规范要求。
