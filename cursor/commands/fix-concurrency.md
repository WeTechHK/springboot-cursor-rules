# /fix-concurrency 命令

## 命令格式
```bash
/fix-concurrency [问题场景] [并发类型]
```

## 参数说明
- `[问题场景]`: 问题场景，如订单创建、库存扣减、用户注册等
- `[并发类型]`: 并发类型，如并发冲突、死锁、竞态条件等

## 功能说明
修复并发问题，包括：
- 并发问题分析
- 并发控制方案
- 线程安全实现
- 并发测试验证
- 并发监控配置

## 生成内容

### 1. 并发问题分析
- 并发问题识别
- 并发问题根因分析
- 并发影响评估
- 并发控制目标

### 2. 并发控制方案
- 并发控制策略设计
- 线程安全实现方案
- 锁机制设计
- 并发控制风险评估

### 3. 并发控制实现
- 线程安全代码实现
- 锁机制实现
- 并发控制逻辑
- 异常处理机制

### 4. 并发测试用例
- 并发测试场景
- 压力测试用例
- 死锁测试用例
- 并发回归测试

### 5. 并发监控配置
- 并发指标监控
- 死锁监控配置
- 并发性能监控
- 并发告警配置

## 编码规范遵循
根据`.cursor/rules/02-coding-standards/coding-standards.mdc`：
- ✅ 合理使用并发控制机制
- ✅ 避免死锁和竞态条件
- ✅ 使用线程安全的数据结构
- ✅ 合理的事务边界控制
- ✅ 并发性能优化

## 使用示例

### 1. 修复订单创建并发冲突
```bash
/fix-concurrency OrderCreate 订单创建并发冲突
```

### 2. 修复库存扣减并发问题
```bash
/fix-concurrency InventoryDeduct 库存扣减并发问题
```

### 3. 修复用户注册并发问题
```bash
/fix-concurrency UserRegister 用户注册并发问题
```

## 并发问题类型

### 1. 并发冲突问题
- 数据并发修改冲突
- 业务状态并发冲突
- 资源并发访问冲突
- 事务并发冲突

### 2. 死锁问题
- 数据库死锁
- 应用层死锁
- 资源死锁
- 循环等待死锁

### 3. 竞态条件问题
- 条件检查竞态
- 状态更新竞态
- 资源分配竞态
- 时序依赖竞态

### 4. 线程安全问题
- 共享数据访问
- 非原子操作
- 内存可见性问题
- 指令重排序问题

## 并发控制策略

### 1. 锁机制
- 悲观锁控制
- 乐观锁控制
- 分布式锁控制
- 读写锁控制

### 2. 事务控制
- 事务隔离级别
- 事务传播行为
- 事务回滚机制
- 分布式事务

### 3. 并发数据结构
- 线程安全集合
- 原子操作类
- 并发队列
- 并发映射

### 4. 异步处理
- 异步任务处理
- 消息队列处理
- 事件驱动处理
- 响应式编程

## 并发控制特性
1. **安全性**: 保证并发操作的安全性
2. **一致性**: 保证数据的一致性
3. **性能**: 优化并发性能
4. **可监控**: 并发监控和告警
5. **可维护**: 并发控制代码可维护

## 技术实现
- **锁**: 使用synchronized、ReentrantLock等
- **原子**: 使用Atomic类、CAS操作
- **事务**: 使用Spring事务管理
- **异步**: 使用@Async、CompletableFuture
- **监控**: 并发监控和告警

## 注意事项
1. 修复前会进行并发问题分析
2. 修复过程中保持功能完整性
3. 修复后提供完整的并发测试验证
4. 遵循项目的编码规范和并发规范
5. 修复结果可以直接运行和测试
