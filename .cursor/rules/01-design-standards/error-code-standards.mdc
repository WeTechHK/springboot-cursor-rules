---
description: 13位错误码编码规则（结构、取值、约束、示例），适用于所有 Spring Boot 项目。
globs:
alwaysApply: true
---

# 错误码设计规范

## 13位错误码编码规则
- 错误码由 13 位字符组成，固定位置与取值规则如下：
  1) 第 1～4 位：子系统编号（SubSystem，4 位）。
     - 取值范围：数字或大写字母（建议数字），由组织统一分配；必须全局唯一。
  2) 第 5 位：错误类型（Type，1 位）。
     - 取值：
       - B：业务类错误（Business）。与业务规则相关，如余额不足、状态不允许。
       - T：响应方技术类错误（Tech of Responder）。程序异常/崩溃、配置错误、网络失败等。
       - C：请求方技术类错误（Tech of Caller）。请求报文格式不正确、解析失败等。
       - U：结果未知（Unknown）。如调用超时、对账未明。
       - S：成功（Success）。交易成功时使用；此时第 6～13 位推荐统一填 0。
       - 其他：保留，禁止使用。
  3) 第 6～7 位：预留位（Reserved，2 位）。
     - 取值范围：数字或大写字母；字母位保留给开发框架，需先分配后使用。
     - 兼容性建议：当前阶段推荐统一填 0（“00”）。
  4) 第 8～13 位：子系统内编码（Local Code，6 位）。
     - 取值范围：仅数字；由各子系统在本子系统内统一分配，需保证不重复。

## 编码约束
- 全局唯一：同一 13 位错误码在全系统范围内唯一且稳定，不得复用或改义。
- 可读可归档：子系统需维护对照表（码值、含义、场景、HTTP 映射、默认消息）。
- S 类型码：表示成功，建议统一形如：{子系统}{S}{00}{000000}。
- 兼容升级：如需扩展“预留位”，仅在完成登记、评审后启用非“00”的值。

## 示例
- 业务错误（账户余额不足）：`1001B00 000123` → `1001B00000123`
- 响应方技术错误（配置缺失）：`1001T00 000045` → `1001T00000045`
- 请求方技术错误（报文非法）：`1001C00 000007` → `1001C00000007`
- 结果未知（超时）：`1001U00 000099` → `1001U00000099`
- 成功：`1001S00 000000` → `1001S00000000`

## 使用规范（输出映射）
- 返回体对齐统一模型 `CommonResponse<T>`：`code` 使用 13 位字符串；`msg` 为人类可读信息。
- HTTP 状态码建议：
  - 成功：200/201。
  - 客户端错误（常对应 C/B）：400/401/403/404/409/429。
  - 服务端错误（常对应 T/U）：500/502/503/504。
- 日志与监控：记录错误码、traceId、关键上下文；按错误码聚合告警。

## 校验规则（实现建议）
- 长度等式：`^[A-Z0-9]{4}[BTCUS]{1}[A-Z0-9]{2}[0-9]{6}$`
- S 类型校验：类型位为 `S` 时，第 6～13 位需为 `0{8}`（可根据组织策略放宽为全 0）。
