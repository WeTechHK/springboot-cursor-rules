# /create-exception 命令

## 命令格式
```bash
/create-exception [一段描述性的话]
```

## 功能说明
创建自定义异常类，包括业务异常、系统异常、错误码映射和异常处理机制。

## AI分析流程

### 1. 智能描述解析
- **提取关键信息**：从用户描述中提取异常类型、错误场景、业务需求
- **识别异常类型**：判断是业务异常、系统异常、参数异常等
- **推断异常结构**：基于描述推断合适的异常结构和错误码

### 2. 智能文档发现
- **自动扫描**：扫描项目根目录下的`docs/`目录中的错误码文档、异常文档、业务文档
- **内容匹配**：基于描述内容匹配相关异常文档
- **信息提取**：从文档中提取错误码定义、异常场景、处理规则等

### 3. 基于项目结构的智能推断
- **项目分析**：分析现有项目的异常设计风格、错误码规范
- **异常识别**：识别相关异常和错误处理
- **规范推断**：推断项目的异常设计规范

### 4. 异常类规则匹配
- **规范匹配**：根据需求匹配对应的异常类编码规范
- **设计模式**：应用异常设计模式和最佳实践
- **代码生成**：生成符合项目规范的异常类代码

### 5. 主动询问机制
- **异常补全**：识别缺失或模糊的异常需求，主动询问用户
- **错误码确认**：确认错误码和异常信息
- **多轮对话**：支持多轮对话，逐步完善异常设计

## 使用示例

### 1. 简单描述
```bash
/create-exception 用户不存在异常
```

### 2. 详细描述
```bash
/create-exception 用户不存在异常，错误码1001B00000123，包含用户ID信息
```

### 3. 业务场景描述
```bash
/create-exception 订单状态异常，当订单状态不允许操作时抛出
```

### 4. 技术需求描述
```bash
/create-exception 参数校验异常，当请求参数不符合要求时抛出
```

## AI交互示例

### 示例1：简单描述
```bash
# 用户输入
/create-exception 用户不存在异常

# AI响应
AI: 已解析您的描述"用户不存在异常"，并发现以下相关文档：

**发现的设计文档：**
- `docs/exception-design.md` - 异常类设计文档
- `docs/error-code-standards.md` - 错误码规范文档
- `docs/business-exceptions.md` - 业务异常设计文档

基于这些文档，UserNotFoundException将包含以下异常结构：

**推断的异常结构：**
- 异常类名：UserNotFoundException
- 错误码：1001B00000123（业务错误）
- 错误信息：用户不存在
- 异常参数：用户ID

**需要确认的信息：**
1. 异常的具体错误码？
2. 异常的错误信息？
3. 异常需要哪些参数？
4. 是否需要异常链？
5. 是否需要其他相关异常？

请提供详细信息，或者确认我的推断是否正确？
```

### 示例2：详细描述
```bash
# 用户输入
/create-exception 用户不存在异常，错误码1001B00000123，包含用户ID信息

# AI响应
AI: 已解析您的详细描述，UserNotFoundException将包含以下内容：

**解析的异常结构：**
- 异常类名：UserNotFoundException
- 错误码：1001B00000123
- 错误信息：用户不存在
- 异常参数：用户ID

**推断的异常方法：**
- 构造函数：支持错误码、错误信息、用户ID
- getUserId() - 获取用户ID
- getErrorCode() - 获取错误码
- getErrorMessage() - 获取错误信息

**推断的异常特性：**
- 继承RuntimeException
- 包含错误码字段
- 包含业务参数
- 支持异常链

**需要确认的信息：**
1. 错误信息的具体内容？
2. 是否需要其他业务参数？
3. 是否需要异常链支持？
4. 是否需要日志记录？

请确认以上信息是否正确，或者提供更多详细信息？
```

## 生成内容

### 1. 异常类定义
- 异常类名以`Exception`结尾
- 继承`RuntimeException`或具体异常类
- 包含错误码字段
- 完整的JavaDoc注释

### 2. 构造函数
- 支持错误码、错误信息构造
- 支持业务参数构造
- 支持异常链构造
- 支持多种构造方式

### 3. 错误码映射
- 使用13位错误码规范
- 错误码类型标识（B/T/C/U/S）
- 子系统编号和内部编码
- 错误码验证和查找

### 4. 异常信息
- 清晰的错误信息
- 包含业务上下文
- 支持国际化
- 避免敏感信息泄露

### 5. 异常处理
- 全局异常处理器支持
- 异常日志记录
- 异常监控和告警
- 异常恢复机制

## 标准异常类型

### 1. 业务异常
- `BusinessException` - 通用业务异常
- `UserNotFoundException` - 用户不存在
- `OrderStatusException` - 订单状态异常
- `PermissionDeniedException` - 权限拒绝

### 2. 参数异常
- `ParameterException` - 参数异常
- `ValidationException` - 校验异常
- `FormatException` - 格式异常
- `RequiredException` - 必填异常

### 3. 系统异常
- `SystemException` - 系统异常
- `DatabaseException` - 数据库异常
- `NetworkException` - 网络异常
- `ConfigurationException` - 配置异常

### 4. 第三方异常
- `ThirdPartyException` - 第三方服务异常
- `PaymentException` - 支付异常
- `NotificationException` - 通知异常
- `StorageException` - 存储异常

## 异常类特性
1. **错误码规范**: 使用13位错误码规范
2. **异常链**: 支持异常链传递
3. **业务上下文**: 包含业务相关参数
4. **日志记录**: 自动记录异常日志
5. **可维护**: 清晰的代码结构和注释

## 技术实现
- **继承**: 继承RuntimeException或具体异常
- **错误码**: 使用13位错误码规范
- **参数**: 包含业务相关参数
- **日志**: 集成日志记录
- **处理**: 支持全局异常处理

## 注意事项
1. AI会根据描述自动推断异常结构
2. 自动处理错误码和异常信息
3. 包含完整的异常处理机制
4. 遵循项目的编码规范和错误码规范
5. 生成的代码可以直接运行和测试
6. 支持多轮对话完善需求
7. 支持文档引用和智能推断
8. 支持自然语言描述

## 最佳实践建议

### 1. 描述技巧
- **具体描述**: 提供详细的异常需求描述，AI能更好地理解需求
- **关键信息**: 包含错误码、错误信息、业务参数
- **场景说明**: 说明异常的使用场景

### 2. 交互技巧
- **分步确认**: 先确认核心异常，再完善异常细节
- **及时反馈**: 对AI的推断及时提供反馈
- **迭代优化**: 基于生成结果进行迭代优化

### 3. 文档使用
- **错误码文档**: 在项目中维护错误码文档，AI会自动发现
- **异常文档**: 维护异常文档，AI会参考生成异常
- **业务文档**: 维护业务文档，AI会参考生成业务异常