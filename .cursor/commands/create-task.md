# /create-task 命令

## 命令格式
```bash
/create-task [一段描述性的话]
```

## 功能说明
创建定时任务类，包括任务类定义、定时任务配置、任务执行逻辑、异常处理机制和任务监控配置。

## AI分析流程

### 1. 智能描述解析
- **提取关键信息**：从用户描述中提取任务名称、任务类型、执行需求
- **识别任务类型**：判断是数据同步、清理任务、统计任务、监控任务等
- **推断执行复杂度**：基于描述推断任务的复杂度和执行策略

### 2. 智能文档发现
- **自动扫描**：扫描项目根目录下的`docs/`目录中的任务文档、调度文档、监控文档
- **内容匹配**：基于描述内容匹配相关任务文档
- **信息提取**：从文档中提取任务需求、调度策略、监控要求等
- **文件显示**：在AI响应中显示找到的相关设计文件名，便于用户确认

### 3. 基于项目结构的智能推断
- **项目分析**：分析现有项目的任务设计风格、调度策略
- **任务识别**：识别相关任务和调度配置
- **规范推断**：推断项目的任务设计规范

### 4. 任务类规则匹配
- **规范匹配**：根据需求匹配对应的任务类编码规范
- **设计模式**：应用任务设计模式和最佳实践
- **代码生成**：生成符合项目规范的任务类代码

### 5. 主动询问机制
- **任务补全**：识别缺失或模糊的任务需求，主动询问用户
- **调度确认**：确认任务调度策略和执行频率
- **多轮对话**：支持多轮对话，逐步完善任务设计

## 使用示例

### 1. 简单描述
```bash
/create-task 数据同步任务
```

### 2. 详细描述
```bash
/create-task 数据同步任务，每小时同步一次用户数据
```

### 3. 业务场景描述
```bash
/create-task 清理任务，每天清理过期的临时文件
```

### 4. 技术需求描述
```bash
/create-task 统计任务，每天生成业务统计报告
```

## AI交互示例

### 示例1：简单描述
```bash
# 用户输入
/create-task 数据同步任务

# AI响应
AI: 已解析您的描述"数据同步任务"，并发现以下相关文档：

**发现的设计文档：**
- `docs/task-design.md` - 任务设计文档
- `docs/scheduling-config.md` - 调度配置文档
- `docs/data-sync-requirements.md` - 数据同步需求文档

基于这些文档，DataSyncTask将包含以下任务功能：

**推断的任务功能：**
- 定时同步数据
- 数据一致性保证
- 增量同步支持
- 同步状态监控

**需要确认的信息：**
1. 需要同步哪些数据？
2. 同步频率是什么？
3. 是否需要增量同步？
4. 是否需要异常处理？
5. 是否需要监控告警？

请提供详细信息，或者确认我的推断是否正确？
```

### 示例2：详细描述
```bash
# 用户输入
/create-task 数据同步任务，每小时同步一次用户数据

# AI响应
AI: 已解析您的详细描述，DataSyncTask将包含以下功能：

**发现的设计文档：**
- `docs/task-design.md` - 任务设计文档
- `docs/scheduling-config.md` - 调度配置文档
- `docs/data-sync-requirements.md` - 数据同步需求文档

**解析的任务功能：**
- 每小时同步一次用户数据
- 数据一致性保证
- 增量同步支持
- 同步状态监控

**推断的调度配置：**
- @Scheduled(fixedDelayString = "3600000") - 每小时执行一次
- 支持动态配置
- 支持任务开关控制
- 支持异常重试机制

**推断的任务逻辑：**
- 查询需要同步的用户数据
- 执行数据同步操作
- 记录同步状态和日志
- 处理同步异常

**需要确认的信息：**
1. 同步的数据源和目标？
2. 是否需要增量同步？
3. 异常处理策略？
4. 监控告警要求？

请确认以上信息是否正确，或者提供更多详细信息？
```

## 生成内容

### 1. 任务类定义
- 类名以`Task`结尾
- 使用`@Component`注解标记
- 使用`@Slf4j`注解进行日志记录
- 使用`@Scheduled`注解配置调度

### 2. 定时任务配置
- 使用`fixedDelayString`配置固定延迟
- 使用`initialDelayString`配置初始延迟
- 使用SpEL表达式配置动态时间
- 定时任务具有幂等性

### 3. 任务执行逻辑
- 根据任务描述生成相应逻辑
- 任务调度配置
- 配置管理
- 异常处理
- 性能监控

### 4. 异常处理
- 任务方法必须处理异常情况
- 异常必须记录详细的日志信息
- 异常处理必须保证系统稳定性
- 必须避免异常影响主业务流程

### 5. 性能监控
- 定时任务必须避免长时间阻塞
- 推荐使用异步处理提高性能
- 必须进行性能监控和优化
- 避免在任务中进行耗时操作

## 标准任务类型

### 1. 数据同步任务
- `DataSyncTask` - 数据同步任务
- `UserSyncTask` - 用户数据同步
- `OrderSyncTask` - 订单数据同步
- `ProductSyncTask` - 商品数据同步

### 2. 清理任务
- `CleanupTask` - 清理任务
- `FileCleanupTask` - 文件清理任务
- `CacheCleanupTask` - 缓存清理任务
- `LogCleanupTask` - 日志清理任务

### 3. 统计任务
- `StatisticsTask` - 统计任务
- `ReportTask` - 报表生成任务
- `MetricsTask` - 指标统计任务
- `AnalysisTask` - 数据分析任务

### 4. 监控任务
- `HealthCheckTask` - 健康检查任务
- `ServiceMonitorTask` - 服务监控任务
- `ResourceMonitorTask` - 资源监控任务
- `AlertTask` - 告警任务

## 任务特性
1. **定时执行**: 支持多种定时配置
2. **异常处理**: 完整的异常处理机制
3. **性能监控**: 任务执行性能监控
4. **幂等性**: 支持任务重复执行
5. **可维护**: 清晰的代码结构和注释

## 技术实现
- **注解**: 使用Spring Scheduling注解
- **配置**: 支持动态时间配置
- **监控**: 集成任务监控和告警
- **异步**: 支持异步任务处理
- **日志**: 完整的任务执行日志

## 注意事项
1. AI会根据描述自动推断任务逻辑
2. 自动配置定时调度参数
3. 包含完整的异常处理机制
4. 遵循项目的编码规范和任务规范
5. 生成的代码可以直接运行和测试
6. 支持多轮对话完善需求
7. 支持文档引用和智能推断
8. 支持自然语言描述

## 最佳实践建议

### 1. 描述技巧
- **具体描述**: 提供详细的任务需求描述，AI能更好地理解需求
- **关键功能**: 包含核心任务功能，帮助AI生成准确代码
- **调度要求**: 指定任务调度频率和执行策略

### 2. 交互技巧
- **分步确认**: 先确认核心任务，再完善调度配置
- **及时反馈**: 对AI的推断及时提供反馈
- **迭代优化**: 基于生成结果进行迭代优化

### 3. 文档使用
- **任务文档**: 在项目中维护任务文档，AI会自动发现
- **调度文档**: 维护调度文档，AI会参考生成任务配置
- **监控文档**: 维护监控文档，AI会参考生成监控逻辑