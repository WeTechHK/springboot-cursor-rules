# /setup-database 命令

## 命令格式
```bash
/setup-database [一段描述性的话]
```

## 功能说明
配置数据库，包括数据库连接配置、数据源配置、事务管理配置、数据库初始化脚本和数据库监控配置。

## AI分析流程

### 1. 智能描述解析
- **提取关键信息**：从用户描述中提取数据库类型、配置需求、连接参数
- **识别数据库类型**：判断是MySQL、PostgreSQL、Oracle、H2等数据库
- **推断配置复杂度**：基于描述推断配置的复杂度和技术要求

### 2. 智能文档发现
- **自动扫描**：扫描项目根目录下的`docs/`目录中的数据库文档、配置文档、架构文档
- **内容匹配**：基于描述内容匹配相关数据库文档
- **信息提取**：从文档中提取数据库配置、连接参数、监控要求等
- **文件显示**：在AI响应中显示找到的相关设计文件名，便于用户确认

### 3. 基于项目结构的智能推断
- **项目分析**：分析现有项目的数据库配置、技术栈、架构设计
- **配置识别**：识别相关数据库配置和优化点
- **规范推断**：推断项目的数据库配置规范

### 4. 数据库配置规则匹配
- **规范匹配**：根据需求匹配对应的数据库配置规范
- **配置策略**：应用数据库配置策略和最佳实践
- **代码生成**：生成符合项目规范的数据库配置代码

### 5. 主动询问机制
- **配置补全**：识别缺失或模糊的配置需求，主动询问用户
- **参数确认**：确认数据库连接参数和配置要求
- **多轮对话**：支持多轮对话，逐步完善配置方案

## 使用示例

### 1. 简单描述
```bash
/setup-database 配置MySQL数据库连接
```

### 2. 详细描述
```bash
/setup-database 配置MySQL数据库连接，包含主从配置、连接池配置、事务管理
```

### 3. 业务场景描述
```bash
/setup-database 配置生产环境数据库，包含读写分离、连接池优化、监控配置
```

### 4. 技术需求描述
```bash
/setup-database 配置H2内存数据库用于测试，包含初始化脚本和数据导入
```

## AI交互示例

### 示例1：简单描述
```bash
# 用户输入
/setup-database 配置MySQL数据库连接

# AI响应
AI: 已解析您的描述"配置MySQL数据库连接"，并发现以下相关文档：

**发现的设计文档：**
- `docs/database-config.md` - 数据库配置文档
- `docs/spring-boot-standards.md` - Spring Boot标准文档
- `docs/performance-optimization.md` - 性能优化文档

基于这些文档，将配置以下数据库内容：

**推断的配置内容：**
- 数据库连接配置
- 数据源配置
- 连接池配置
- 事务管理配置

**需要确认的信息：**
基于您的描述，我将智能判断是否需要确认信息：

- **如果描述完整**：直接开始配置数据库连接
- **如果缺少连接信息**：询问数据库连接参数
- **如果缺少性能配置**：询问连接池和性能参数
- **如果缺少监控需求**：询问监控和日志配置
- **如果描述模糊**：询问关键配置细节

**当前状态：** 基于您的描述，我将智能配置数据库连接，如有疑问会主动询问。
```

### 示例2：详细描述
```bash
# 用户输入
/setup-database 配置MySQL数据库连接，包含主从配置、连接池配置、事务管理

# AI响应
AI: 已解析您的详细描述，将配置MySQL数据库连接：

**发现的设计文档：**
- `docs/database-config.md` - 数据库配置文档
- `docs/spring-boot-standards.md` - Spring Boot标准文档
- `docs/performance-optimization.md` - 性能优化文档

**解析的配置方案：**
1. 数据库连接配置
   - 主库连接配置
   - 从库连接配置
   - 读写分离配置
   - 连接参数配置

2. 连接池配置
   - HikariCP连接池配置
   - 连接池大小配置
   - 连接超时配置
   - 连接验证配置

3. 事务管理配置
   - 事务管理器配置
   - 事务隔离级别配置
   - 事务传播行为配置
   - 分布式事务配置

**需要确认的信息：**
基于您的详细描述，我发现以下信息：

✅ **已明确**：MySQL主从配置、连接池、事务管理
✅ **技术栈**：Spring Boot + MyBatis + HikariCP
✅ **配置需求**：读写分离、连接池优化、事务管理

**执行决策：** 信息完整，直接开始配置数据库连接和事务管理
```

## 配置内容

### 1. 数据库连接配置
- 数据库连接参数
- 连接URL配置
- 认证信息配置
- 连接属性配置

### 2. 数据源配置
- 主数据源配置
- 从数据源配置
- 读写分离配置
- 数据源路由配置

### 3. 连接池配置
- 连接池大小配置
- 连接超时配置
- 连接验证配置
- 连接池监控配置

### 4. 事务管理配置
- 事务管理器配置
- 事务隔离级别配置
- 事务传播行为配置
- 分布式事务配置

### 5. 数据库监控配置
- 连接池监控
- 慢查询监控
- 死锁监控
- 性能监控

## 数据库类型

### 1. 关系型数据库
- `MySQL` - MySQL数据库
- `PostgreSQL` - PostgreSQL数据库
- `Oracle` - Oracle数据库
- `SQLServer` - SQL Server数据库

### 2. 内存数据库
- `H2` - H2内存数据库
- `HSQLDB` - HSQLDB内存数据库
- `Derby` - Derby内存数据库

### 3. 分布式数据库
- `ShardingSphere` - 分库分表
- `MyCAT` - 数据库中间件
- `TDDL` - 分布式数据库

### 4. 云数据库
- `RDS` - 阿里云RDS
- `Aurora` - AWS Aurora
- `CloudSQL` - Google Cloud SQL

## 配置特性
1. **灵活性**: 支持多种数据库类型
2. **性能**: 优化的连接池配置
3. **可靠性**: 完善的故障处理机制
4. **可监控**: 完整的监控和告警
5. **可维护**: 清晰的配置结构

## 技术实现
- **配置**: 使用Spring Boot配置
- **连接池**: 使用HikariCP连接池
- **事务**: 使用Spring事务管理
- **监控**: 集成数据库监控
- **脚本**: 数据库初始化脚本

## 注意事项
1. AI会根据描述自动推断数据库配置
2. 自动分析数据库需求和配置要求
3. 提供具体的数据库配置方案
4. 遵循项目的编码规范和配置规范
5. 生成的代码可以直接运行和测试
6. 支持多轮对话完善需求
7. 支持文档引用和智能推断
8. 支持自然语言描述

## 最佳实践建议

### 1. 描述技巧
- **具体描述**: 提供详细的数据库需求描述，AI能更好地理解需求
- **关键参数**: 包含具体的连接参数和配置要求
- **性能要求**: 指定性能要求和优化需求

### 2. 交互技巧
- **分步确认**: 先确认核心配置，再完善配置细节
- **及时反馈**: 对AI的推断及时提供反馈
- **迭代优化**: 基于配置结果进行迭代改进

### 3. 文档使用
- **配置文档**: 在项目中维护数据库配置文档，AI会自动发现
- **架构文档**: 维护架构文档，AI会参考生成配置
- **性能文档**: 维护性能文档，AI会参考生成优化配置