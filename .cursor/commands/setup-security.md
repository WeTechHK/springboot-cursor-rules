# /setup-security 命令

## 命令格式
```bash
/setup-security [一段描述性的话]
```

## 功能说明
配置安全框架，包括认证配置、授权配置、密码加密、JWT配置、安全监控和防护机制。

## AI分析流程

### 1. 智能描述解析
- **提取关键信息**：从用户描述中提取安全需求、认证方式、授权策略
- **识别安全类型**：判断是认证配置、授权配置、密码加密、JWT配置等
- **推断配置复杂度**：基于描述推断安全配置的复杂度和技术要求

### 2. 智能文档发现
- **自动扫描**：扫描项目根目录下的`docs/`目录中的安全文档、认证文档、授权文档
- **内容匹配**：基于描述内容匹配相关安全文档
- **信息提取**：从文档中提取安全策略、认证方式、授权规则等
- **文件显示**：在AI响应中显示找到的相关设计文件名，便于用户确认

### 3. 基于项目结构的智能推断
- **项目分析**：分析现有项目的安全配置、技术栈、架构设计
- **安全识别**：识别相关安全配置和优化点
- **规范推断**：推断项目的安全配置规范

### 4. 安全配置规则匹配
- **规范匹配**：根据需求匹配对应的安全配置规范
- **安全策略**：应用安全配置策略和最佳实践
- **代码生成**：生成符合项目规范的安全配置代码

### 5. 主动询问机制
- **配置补全**：识别缺失或模糊的安全需求，主动询问用户
- **策略确认**：确认安全策略和监控要求
- **多轮对话**：支持多轮对话，逐步完善安全配置方案

## 使用示例

### 1. 简单描述
```bash
/setup-security 配置Spring Security认证授权
```

### 2. 详细描述
```bash
/setup-security 配置Spring Security认证授权，包含JWT认证、角色权限、密码加密
```

### 3. 业务场景描述
```bash
/setup-security 配置用户管理系统安全，包含用户认证、角色管理、权限控制
```

### 4. 技术需求描述
```bash
/setup-security 配置API安全，包含JWT认证、接口权限、跨域配置、防攻击
```

## AI交互示例

### 示例1：简单描述
```bash
# 用户输入
/setup-security 配置Spring Security认证授权

# AI响应
AI: 已解析您的描述"配置Spring Security认证授权"，并发现以下相关文档：

**发现的设计文档：**
- `docs/security-config.md` - 安全配置文档
- `docs/authentication-design.md` - 认证设计文档
- `docs/authorization-design.md` - 授权设计文档

基于这些文档，将配置以下安全内容：

**推断的配置内容：**
- Spring Security配置
- 认证配置
- 授权配置
- 密码加密配置

**需要确认的信息：**
1. 需要哪种认证方式？
2. 是否需要JWT认证？
3. 需要哪些角色和权限？
4. 是否需要密码加密？
5. 是否需要跨域配置？

请提供详细信息，或者确认我的推断是否正确？
```

### 示例2：详细描述
```bash
# 用户输入
/setup-security 配置Spring Security认证授权，包含JWT认证、角色权限、密码加密

# AI响应
AI: 已解析您的详细描述，将配置Spring Security认证授权：

**发现的设计文档：**
- `docs/security-config.md` - 安全配置文档
- `docs/authentication-design.md` - 认证设计文档
- `docs/authorization-design.md` - 授权设计文档

**解析的配置方案：**
1. Spring Security配置
   - SecurityConfig配置类
   - 安全过滤器链配置
   - 安全注解配置
   - 安全异常处理

2. JWT认证配置
   - JWT工具类配置
   - JWT过滤器配置
   - JWT认证提供者
   - JWT令牌管理

3. 角色权限配置
   - 角色定义和配置
   - 权限定义和配置
   - 权限验证配置
   - 权限管理配置

4. 密码加密配置
   - 密码加密器配置
   - 密码验证配置
   - 密码策略配置
   - 密码安全配置

**需要确认的信息：**
1. 具体的角色和权限？
2. JWT的配置参数？
3. 密码加密的强度？
4. 是否需要跨域配置？

请确认以上信息是否正确，或者提供更多详细信息？
```

## 配置内容

### 1. Spring Security配置
- SecurityConfig配置类
- 安全过滤器链配置
- 安全注解配置
- 安全异常处理

### 2. 认证配置
- 用户认证配置
- 认证提供者配置
- 认证成功处理器
- 认证失败处理器

### 3. 授权配置
- 角色权限配置
- 方法级权限控制
- URL级权限控制
- 资源级权限控制

### 4. JWT配置
- JWT工具类配置
- JWT过滤器配置
- JWT认证提供者
- JWT令牌管理

### 5. 密码加密配置
- 密码加密器配置
- 密码验证配置
- 密码策略配置
- 密码安全配置

## 安全类型

### 1. 认证配置
- `AuthenticationConfig` - 认证配置
- `JwtAuthenticationConfig` - JWT认证配置
- `OAuth2Config` - OAuth2认证配置
- `LdapConfig` - LDAP认证配置

### 2. 授权配置
- `AuthorizationConfig` - 授权配置
- `RoleBasedConfig` - 基于角色的授权
- `PermissionBasedConfig` - 基于权限的授权
- `ResourceBasedConfig` - 基于资源的授权

### 3. 密码配置
- `PasswordEncoderConfig` - 密码编码器配置
- `PasswordPolicyConfig` - 密码策略配置
- `PasswordValidationConfig` - 密码验证配置
- `PasswordSecurityConfig` - 密码安全配置

### 4. 安全监控
- `SecurityMonitoringConfig` - 安全监控配置
- `SecurityAuditConfig` - 安全审计配置
- `SecurityAlertConfig` - 安全告警配置
- `SecurityLogConfig` - 安全日志配置

## 配置特性
1. **安全性**: 完善的安全防护机制
2. **灵活性**: 支持多种认证和授权方式
3. **可扩展**: 支持安全功能扩展
4. **可监控**: 完整的安全监控
5. **可维护**: 清晰的安全配置结构

## 技术实现
- **框架**: 使用Spring Security
- **认证**: JWT、OAuth2、LDAP等
- **授权**: 基于角色和权限的授权
- **加密**: BCrypt、Argon2等密码加密
- **监控**: 安全监控和审计

## 注意事项
1. AI会根据描述自动推断安全配置
2. 自动分析安全需求和配置要求
3. 提供具体的安全配置方案
4. 遵循项目的编码规范和安全规范
5. 生成的代码可以直接运行和测试
6. 支持多轮对话完善需求
7. 支持文档引用和智能推断
8. 支持自然语言描述

## 最佳实践建议

### 1. 描述技巧
- **具体描述**: 提供详细的安全需求描述，AI能更好地理解需求
- **关键功能**: 包含具体的认证和授权要求
- **安全要求**: 指定安全级别和防护要求

### 2. 交互技巧
- **分步确认**: 先确认核心安全功能，再完善配置细节
- **及时反馈**: 对AI的推断及时提供反馈
- **迭代优化**: 基于配置结果进行迭代改进

### 3. 文档使用
- **安全文档**: 在项目中维护安全文档，AI会自动发现
- **认证文档**: 维护认证文档，AI会参考生成认证配置
- **授权文档**: 维护授权文档，AI会参考生成授权配置