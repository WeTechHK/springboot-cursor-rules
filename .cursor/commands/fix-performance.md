# /fix-performance 命令

## 命令格式
```bash
/fix-performance [一段描述性的话]
```

## 功能说明
修复性能问题，包括性能分析、瓶颈识别、优化方案实施和性能监控配置。

## AI分析流程

### 1. 智能描述解析
- **提取关键信息**：从用户描述中提取性能问题、影响范围、优化需求
- **识别问题类型**：判断是数据库性能、接口性能、内存性能、并发性能等
- **推断优化复杂度**：基于描述推断优化的复杂度和实施难度

### 2. 智能文档发现
- **自动扫描**：扫描项目根目录下的`docs/`目录中的性能文档、监控文档、优化文档
- **内容匹配**：基于描述内容匹配相关性能文档
- **信息提取**：从文档中提取性能指标、优化策略、监控配置等
- **文件显示**：在AI响应中显示找到的相关设计文件名，便于用户确认

### 3. 基于项目结构的智能推断
- **项目分析**：分析现有项目的性能瓶颈、技术栈、架构设计
- **问题识别**：识别相关性能问题和优化点
- **规范推断**：推断项目的性能优化规范

### 4. 性能优化规则匹配
- **规范匹配**：根据需求匹配对应的性能优化规范
- **优化策略**：应用性能优化策略和最佳实践
- **代码生成**：生成符合项目规范的性能优化代码

### 5. 主动询问机制
- **问题补全**：识别缺失或模糊的性能问题，主动询问用户
- **优化确认**：确认优化方案和监控要求
- **多轮对话**：支持多轮对话，逐步完善优化方案

## 使用示例

### 1. 简单描述
```bash
/fix-performance 数据库查询性能问题
```

### 2. 详细描述
```bash
/fix-performance 用户查询接口响应慢，需要优化数据库查询和缓存
```

### 3. 业务场景描述
```bash
/fix-performance 订单列表分页查询性能问题，数据量大时响应很慢
```

### 4. 技术需求描述
```bash
/fix-performance 系统内存使用过高，需要优化对象创建和垃圾回收
```

## AI交互示例

### 示例1：简单描述
```bash
# 用户输入
/fix-performance 数据库查询性能问题

# AI响应
AI: 已解析您的描述"数据库查询性能问题"，并发现以下相关文档：

**发现的设计文档：**
- `docs/performance-optimization.md` - 性能优化文档
- `docs/database-optimization.md` - 数据库优化文档
- `docs/monitoring-config.md` - 监控配置文档

基于这些文档，将针对以下优化方向进行性能修复：

**推断的优化方向：**
- 数据库索引优化
- SQL查询优化
- 连接池配置优化
- 缓存策略优化

**需要确认的信息：**
基于您的描述，我将智能判断是否需要确认信息：

- **如果描述完整**：直接开始性能优化
- **如果缺少性能数据**：询问具体的性能指标和瓶颈
- **如果缺少优化策略**：询问具体的优化方案需求
- **如果缺少监控信息**：询问性能监控和测试数据
- **如果描述模糊**：询问关键性能问题

**当前状态：** 基于您的描述，我将智能分析性能问题并提供优化方案，如有疑问会主动询问。
```

### 示例2：详细描述
```bash
# 用户输入
/fix-performance 用户查询接口响应慢，需要优化数据库查询和缓存

# AI响应
AI: 已解析您的详细描述，将针对用户查询接口进行性能优化：

**发现的设计文档：**
- `docs/performance-optimization.md` - 性能优化文档
- `docs/database-optimization.md` - 数据库优化文档
- `docs/cache-strategy.md` - 缓存策略文档

**解析的优化方案：**
1. 数据库查询优化
   - 添加必要的索引
   - 优化SQL查询语句
   - 使用分页查询
   - 避免N+1查询问题

2. 缓存策略优化
   - 添加Redis缓存
   - 设置合理的缓存过期时间
   - 使用缓存预热
   - 实现缓存更新策略

3. 代码层面优化
   - 使用批量查询
   - 优化对象创建
   - 减少不必要的计算

**需要确认的信息：**
基于您的详细描述，我发现以下信息：

✅ **已明确**：用户查询慢、数据量大、需要缓存优化
✅ **性能问题**：查询响应慢、数据库压力大
✅ **优化策略**：Redis缓存、索引优化、分页查询

**执行决策：** 信息完整，直接开始性能优化和缓存配置
```

## 优化内容

### 1. 数据库性能优化
- 索引优化和创建
- SQL查询语句优化
- 连接池配置优化
- 分页查询优化
- 避免N+1查询问题

### 2. 缓存策略优化
- Redis缓存配置
- 缓存键设计
- 缓存过期策略
- 缓存更新策略
- 缓存预热机制

### 3. 代码层面优化
- 算法复杂度优化
- 对象创建优化
- 内存使用优化
- 并发处理优化
- 异步处理优化

### 4. 系统配置优化
- JVM参数优化
- 线程池配置优化
- 连接池配置优化
- 系统资源优化

### 5. 监控和告警
- 性能指标监控
- 慢查询监控
- 内存使用监控
- 响应时间监控
- 告警配置

## 标准优化类型

### 1. 数据库优化
- `DatabaseOptimization` - 数据库性能优化
- `IndexOptimization` - 索引优化
- `QueryOptimization` - 查询优化
- `ConnectionOptimization` - 连接优化

### 2. 缓存优化
- `CacheOptimization` - 缓存性能优化
- `RedisOptimization` - Redis缓存优化
- `MemoryCacheOptimization` - 内存缓存优化
- `CacheStrategyOptimization` - 缓存策略优化

### 3. 代码优化
- `AlgorithmOptimization` - 算法优化
- `MemoryOptimization` - 内存优化
- `ConcurrencyOptimization` - 并发优化
- `AsyncOptimization` - 异步优化

### 4. 系统优化
- `JvmOptimization` - JVM优化
- `ThreadPoolOptimization` - 线程池优化
- `ResourceOptimization` - 资源优化
- `ConfigurationOptimization` - 配置优化

## 性能优化特性
1. **针对性**: 针对具体性能问题进行优化
2. **系统性**: 从多个维度进行优化
3. **可测量**: 提供性能指标和监控
4. **可维护**: 优化方案可维护和扩展
5. **可验证**: 优化效果可验证和测试

## 技术实现
- **分析**: 使用性能分析工具
- **监控**: 集成性能监控系统
- **优化**: 应用性能优化策略
- **测试**: 性能测试和验证
- **告警**: 性能告警和通知

## 注意事项
1. AI会根据描述自动推断优化方案
2. 自动分析性能瓶颈和优化点
3. 提供具体的优化实施步骤
4. 遵循项目的性能优化规范
5. 生成的代码可以直接运行和测试
6. 支持多轮对话完善需求
7. 支持文档引用和智能推断
8. 支持自然语言描述

## 最佳实践建议

### 1. 描述技巧
- **具体描述**: 提供详细的性能问题描述，AI能更好地理解需求
- **关键指标**: 包含性能指标和影响范围
- **优化目标**: 指定优化目标和期望效果

### 2. 交互技巧
- **分步确认**: 先确认核心问题，再完善优化方案
- **及时反馈**: 对AI的推断及时提供反馈
- **迭代优化**: 基于优化结果进行迭代改进

### 3. 文档使用
- **性能文档**: 在项目中维护性能文档，AI会自动发现
- **监控文档**: 维护监控文档，AI会参考生成监控配置
- **优化文档**: 维护优化文档，AI会参考生成优化方案