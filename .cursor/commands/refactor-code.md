# /refactor-code 命令

## 命令格式
```bash
/refactor-code [一段描述性的话]
```

## 功能说明
重构代码，包括代码结构优化、设计模式应用、代码质量提升和可维护性改进。

## AI分析流程

### 1. 智能描述解析
- **提取关键信息**：从用户描述中提取重构目标、代码问题、改进需求
- **识别重构类型**：判断是结构重构、性能重构、设计重构、质量重构等
- **推断重构复杂度**：基于描述推断重构的复杂度和影响范围

### 2. 智能文档发现
- **自动扫描**：扫描项目根目录下的`docs/`目录中的重构文档、设计文档、代码规范文档
- **内容匹配**：基于描述内容匹配相关重构文档
- **信息提取**：从文档中提取重构策略、设计模式、代码规范等
- **文件显示**：在AI响应中显示找到的相关设计文件名，便于用户确认

### 3. 基于项目结构的智能推断
- **项目分析**：分析现有项目的代码结构、设计模式、代码质量
- **问题识别**：识别相关代码问题和改进点
- **规范推断**：推断项目的代码重构规范

### 4. 代码重构规则匹配
- **规范匹配**：根据需求匹配对应的代码重构规范
- **重构策略**：应用代码重构策略和最佳实践
- **代码生成**：生成符合项目规范的重构代码

### 5. 主动询问机制
- **问题补全**：识别缺失或模糊的重构需求，主动询问用户
- **方案确认**：确认重构方案和影响范围
- **多轮对话**：支持多轮对话，逐步完善重构方案

## 使用示例

### 1. 简单描述
```bash
/refactor-code 优化用户服务类代码结构
```

### 2. 详细描述
```bash
/refactor-code 优化用户服务类代码结构，提取公共方法，减少代码重复
```

### 3. 业务场景描述
```bash
/refactor-code 重构订单处理逻辑，使用策略模式处理不同订单类型
```

### 4. 技术需求描述
```bash
/refactor-code 重构数据访问层，使用Repository模式统一数据访问
```

## AI交互示例

### 示例1：简单描述
```bash
# 用户输入
/refactor-code 优化用户服务类代码结构

# AI响应
AI: 已解析您的描述"优化用户服务类代码结构"，并发现以下相关文档：

**发现的设计文档：**
- `docs/refactoring-standards.md` - 重构标准文档
- `docs/design-patterns.md` - 设计模式文档
- `docs/code-quality-standards.md` - 代码质量标准文档

基于这些文档，将针对以下方向进行代码重构：

**推断的重构方向：**
- 提取公共方法
- 减少代码重复
- 优化方法结构
- 应用设计模式

**需要确认的信息：**
1. 具体是哪个用户服务类？
2. 主要存在什么问题？
3. 是否需要应用特定设计模式？
4. 是否需要保持向后兼容？
5. 是否需要重构相关测试？

请提供详细信息，或者确认我的推断是否正确？
```

### 示例2：详细描述
```bash
# 用户输入
/refactor-code 优化用户服务类代码结构，提取公共方法，减少代码重复

# AI响应
AI: 已解析您的详细描述，将针对用户服务类进行代码结构优化：

**发现的设计文档：**
- `docs/refactoring-standards.md` - 重构标准文档
- `docs/design-patterns.md` - 设计模式文档
- `docs/code-quality-standards.md` - 代码质量标准文档

**解析的重构方案：**
1. 提取公共方法
   - 识别重复代码块
   - 提取公共方法
   - 参数化处理
   - 统一异常处理

2. 优化方法结构
   - 拆分大方法
   - 优化方法命名
   - 简化方法逻辑
   - 提高可读性

3. 应用设计模式
   - 策略模式处理不同业务逻辑
   - 模板方法模式统一处理流程
   - 工厂模式创建对象

**需要确认的信息：**
1. 具体的用户服务类文件？
2. 重复代码的具体位置？
3. 是否需要保持接口兼容？
4. 是否需要重构相关测试？

请确认以上信息是否正确，或者提供更多详细信息？
```

## 重构内容

### 1. 代码结构优化
- 方法提取和重构
- 类结构优化
- 包结构重组
- 依赖关系优化

### 2. 设计模式应用
- 策略模式
- 工厂模式
- 模板方法模式
- 观察者模式
- 装饰器模式

### 3. 代码质量提升
- 消除代码重复
- 提高代码可读性
- 优化命名规范
- 简化复杂逻辑

### 4. 性能优化
- 算法优化
- 数据结构优化
- 内存使用优化
- 并发处理优化

### 5. 可维护性改进
- 提高代码可测试性
- 增强错误处理
- 完善文档注释
- 统一代码风格

## 标准重构类型

### 1. 结构重构
- `ExtractMethod` - 提取方法
- `ExtractClass` - 提取类
- `MoveMethod` - 移动方法
- `InlineMethod` - 内联方法

### 2. 设计重构
- `ApplyStrategyPattern` - 应用策略模式
- `ApplyFactoryPattern` - 应用工厂模式
- `ApplyTemplatePattern` - 应用模板方法模式
- `ApplyObserverPattern` - 应用观察者模式

### 3. 质量重构
- `EliminateDuplication` - 消除重复代码
- `ImproveReadability` - 提高可读性
- `OptimizeNaming` - 优化命名
- `SimplifyLogic` - 简化逻辑

### 4. 性能重构
- `OptimizeAlgorithm` - 优化算法
- `OptimizeDataStructure` - 优化数据结构
- `OptimizeMemory` - 优化内存使用
- `OptimizeConcurrency` - 优化并发处理

## 代码重构特性
1. **安全性**: 保持功能不变的前提下进行重构
2. **渐进性**: 支持渐进式重构，降低风险
3. **可测试性**: 重构后代码更易于测试
4. **可维护性**: 提高代码的可维护性
5. **可扩展性**: 增强代码的可扩展性

## 技术实现
- **分析**: 代码质量分析和问题识别
- **重构**: 应用重构模式和最佳实践
- **测试**: 重构后代码测试和验证
- **文档**: 更新相关文档和注释
- **验证**: 功能验证和性能测试

## 注意事项
1. AI会根据描述自动推断重构方案
2. 自动分析代码问题和改进点
3. 提供具体的重构实施步骤
4. 遵循项目的代码重构规范
5. 生成的代码可以直接运行和测试
6. 支持多轮对话完善需求
7. 支持文档引用和智能推断
8. 支持自然语言描述

## 最佳实践建议

### 1. 描述技巧
- **具体描述**: 提供详细的重构需求描述，AI能更好地理解需求
- **关键问题**: 包含具体的代码问题和改进目标
- **影响范围**: 指定重构的影响范围和约束条件

### 2. 交互技巧
- **分步确认**: 先确认核心问题，再完善重构方案
- **及时反馈**: 对AI的推断及时提供反馈
- **迭代优化**: 基于重构结果进行迭代改进

### 3. 文档使用
- **重构文档**: 在项目中维护重构文档，AI会自动发现
- **设计文档**: 维护设计文档，AI会参考应用设计模式
- **规范文档**: 维护代码规范文档，AI会参考进行重构