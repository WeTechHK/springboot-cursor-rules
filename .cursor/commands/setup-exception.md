# /setup-exception 命令

## 命令格式
```bash
/setup-exception [一段描述性的话]
```

## 功能说明
配置异常处理，包括全局异常处理器、异常分类、错误码映射、异常监控和异常恢复机制。

## AI分析流程

### 1. 智能描述解析
- **提取关键信息**：从用户描述中提取异常类型、处理需求、错误码要求
- **识别异常类型**：判断是业务异常、系统异常、参数异常、网络异常等
- **推断配置复杂度**：基于描述推断异常处理的复杂度和技术要求

### 2. 智能文档发现
- **自动扫描**：扫描项目根目录下的`docs/`目录中的异常文档、错误码文档、监控文档
- **内容匹配**：基于描述内容匹配相关异常文档
- **信息提取**：从文档中提取异常策略、错误码定义、监控要求等
- **文件显示**：在AI响应中显示找到的相关设计文件名，便于用户确认

### 3. 基于项目结构的智能推断
- **项目分析**：分析现有项目的异常处理、错误码规范、监控配置
- **异常识别**：识别相关异常处理和优化点
- **规范推断**：推断项目的异常处理规范

### 4. 异常处理规则匹配
- **规范匹配**：根据需求匹配对应的异常处理规范
- **处理策略**：应用异常处理策略和最佳实践
- **代码生成**：生成符合项目规范的异常处理代码

### 5. 主动询问机制
- **配置补全**：识别缺失或模糊的异常处理需求，主动询问用户
- **策略确认**：确认异常处理策略和监控要求
- **多轮对话**：支持多轮对话，逐步完善异常处理方案

## 使用示例

### 1. 简单描述
```bash
/setup-exception 配置全局异常处理器
```

### 2. 详细描述
```bash
/setup-exception 配置全局异常处理器，包含业务异常、系统异常、参数异常的统一处理
```

### 3. 业务场景描述
```bash
/setup-exception 配置订单模块异常处理，包含订单状态异常、支付异常、库存异常
```

### 4. 技术需求描述
```bash
/setup-exception 配置13位错误码异常处理，包含错误码映射、异常分类、监控告警
```

## AI交互示例

### 示例1：简单描述
```bash
# 用户输入
/setup-exception 配置全局异常处理器

# AI响应
AI: 已解析您的描述"配置全局异常处理器"，并发现以下相关文档：

**发现的设计文档：**
- `docs/exception-handling.md` - 异常处理文档
- `docs/error-code-standards.md` - 错误码标准文档
- `docs/monitoring-config.md` - 监控配置文档

基于这些文档，将配置以下异常处理内容：

**推断的配置内容：**
- 全局异常处理器
- 异常分类处理
- 错误码映射
- 异常监控配置

**需要确认的信息：**
1. 需要处理哪些异常类型？
2. 是否需要错误码映射？
3. 是否需要异常监控？
4. 是否需要异常恢复机制？
5. 是否需要异常日志记录？

请提供详细信息，或者确认我的推断是否正确？
```

### 示例2：详细描述
```bash
# 用户输入
/setup-exception 配置全局异常处理器，包含业务异常、系统异常、参数异常的统一处理

# AI响应
AI: 已解析您的详细描述，将配置全局异常处理器：

**发现的设计文档：**
- `docs/exception-handling.md` - 异常处理文档
- `docs/error-code-standards.md` - 错误码标准文档
- `docs/monitoring-config.md` - 监控配置文档

**解析的配置方案：**
1. 全局异常处理器
   - @ControllerAdvice全局异常处理
   - 异常分类处理
   - 统一响应格式
   - 异常日志记录

2. 异常分类处理
   - 业务异常处理
   - 系统异常处理
   - 参数异常处理
   - 网络异常处理

3. 错误码映射
   - 13位错误码规范
   - 错误码分类映射
   - 错误信息国际化
   - 错误码监控

**需要确认的信息：**
1. 具体的异常分类？
2. 错误码的具体规范？
3. 是否需要异常监控？
4. 是否需要异常恢复？

请确认以上信息是否正确，或者提供更多详细信息？
```

## 配置内容

### 1. 全局异常处理器
- @ControllerAdvice全局异常处理
- 异常分类处理
- 统一响应格式
- 异常日志记录

### 2. 异常分类处理
- 业务异常处理
- 系统异常处理
- 参数异常处理
- 网络异常处理

### 3. 错误码映射
- 13位错误码规范
- 错误码分类映射
- 错误信息国际化
- 错误码监控

### 4. 异常监控配置
- 异常统计监控
- 异常告警配置
- 异常趋势分析
- 异常恢复监控

### 5. 异常恢复机制
- 自动重试机制
- 降级处理机制
- 熔断保护机制
- 异常恢复策略

## 异常类型

### 1. 业务异常
- `BusinessException` - 业务异常
- `ValidationException` - 校验异常
- `PermissionException` - 权限异常
- `ResourceException` - 资源异常

### 2. 系统异常
- `SystemException` - 系统异常
- `DatabaseException` - 数据库异常
- `NetworkException` - 网络异常
- `ConfigurationException` - 配置异常

### 3. 参数异常
- `ParameterException` - 参数异常
- `FormatException` - 格式异常
- `RequiredException` - 必填异常
- `RangeException` - 范围异常

### 4. 第三方异常
- `ThirdPartyException` - 第三方异常
- `PaymentException` - 支付异常
- `NotificationException` - 通知异常
- `StorageException` - 存储异常

## 配置特性
1. **统一性**: 统一的异常处理机制
2. **分类性**: 异常分类处理
3. **可监控**: 完整的异常监控
4. **可恢复**: 异常恢复机制
5. **可维护**: 清晰的异常处理结构

## 技术实现
- **处理器**: 使用@ControllerAdvice
- **分类**: 异常分类处理
- **映射**: 错误码映射
- **监控**: 异常监控集成
- **恢复**: 异常恢复机制

## 注意事项
1. AI会根据描述自动推断异常处理配置
2. 自动分析异常类型和处理需求
3. 提供具体的异常处理配置方案
4. 遵循项目的编码规范和异常处理规范
5. 生成的代码可以直接运行和测试
6. 支持多轮对话完善需求
7. 支持文档引用和智能推断
8. 支持自然语言描述

## 最佳实践建议

### 1. 描述技巧
- **具体描述**: 提供详细的异常处理需求描述，AI能更好地理解需求
- **关键类型**: 包含具体的异常类型和处理要求
- **监控要求**: 指定监控和告警需求

### 2. 交互技巧
- **分步确认**: 先确认核心异常类型，再完善处理细节
- **及时反馈**: 对AI的推断及时提供反馈
- **迭代优化**: 基于配置结果进行迭代改进

### 3. 文档使用
- **异常文档**: 在项目中维护异常处理文档，AI会自动发现
- **错误码文档**: 维护错误码文档，AI会参考生成错误码映射
- **监控文档**: 维护监控文档，AI会参考生成监控配置