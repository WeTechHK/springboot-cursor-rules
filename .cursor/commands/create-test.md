# /create-test 命令

## 命令格式
```bash
/create-test [一段描述性的话]
```

## 功能说明
创建单元测试和集成测试，包括测试用例、Mock对象、断言验证和测试数据。

## AI分析流程

### 1. 智能描述解析
- **提取关键信息**：从用户描述中提取测试类型、测试范围、测试需求
- **识别测试类型**：判断是单元测试、集成测试、性能测试等
- **推断测试复杂度**：评估测试的复杂度和测试深度

### 2. 智能文档发现
- **自动扫描**：扫描项目根目录下的`docs/`目录中的测试文档、规范文档、业务文档
- **内容匹配**：基于描述内容匹配相关测试文档
- **信息提取**：从文档中提取测试规范、测试用例、测试数据等

### 3. 基于项目结构的智能推断
- **项目分析**：分析现有项目的测试风格、测试框架
- **测试识别**：识别相关测试和测试规范
- **规范推断**：推断项目的测试设计规范

### 4. 测试类规则匹配
- **规范匹配**：根据需求匹配对应的测试编码规范
- **设计模式**：应用测试设计模式和最佳实践
- **代码生成**：生成符合项目规范的测试代码

### 5. 主动询问机制
- **测试补全**：识别缺失或模糊的测试需求，主动询问用户
- **用例确认**：确认测试用例和测试数据
- **多轮对话**：支持多轮对话，逐步完善测试设计

## 使用示例

### 1. 简单描述
```bash
/create-test 用户服务单元测试
```

### 2. 详细描述
```bash
/create-test 用户服务单元测试，包含用户注册、登录、信息更新测试用例
```

### 3. 业务场景描述
```bash
/create-test 订单控制器集成测试，包含订单创建、支付、状态更新测试
```

### 4. 技术需求描述
```bash
/create-test 数据访问层测试，包含CRUD操作、复杂查询、事务测试
```

## AI交互示例

### 示例1：简单描述
```bash
# 用户输入
/create-test 用户服务单元测试

# AI响应
AI: 已解析您的描述"用户服务单元测试"，基于项目结构和测试规范，我推断UserServiceTest可能包含以下测试用例：

**推断的测试用例：**
- testCreateUser() - 测试用户创建
- testUpdateUser() - 测试用户更新
- testDeleteUser() - 测试用户删除
- testGetUserById() - 测试用户查询
- testListUsers() - 测试用户列表

**需要确认的信息：**
1. 需要测试哪些方法？
2. 需要哪些测试场景？
3. 是否需要Mock对象？
4. 是否需要测试数据？
5. 是否需要异常测试？

请提供详细信息，或者确认我的推断是否正确？
```

### 示例2：详细描述
```bash
# 用户输入
/create-test 用户服务单元测试，包含用户注册、登录、信息更新测试用例

# AI响应
AI: 已解析您的详细描述，UserServiceTest将包含以下测试用例：

**解析的测试用例：**
- testRegisterUser() - 测试用户注册
- testLoginUser() - 测试用户登录
- testUpdateUserInfo() - 测试用户信息更新
- testRegisterUserWithInvalidData() - 测试无效数据注册
- testLoginWithInvalidCredentials() - 测试无效凭据登录

**推断的测试结构：**
- 使用JUnit 5测试框架
- 使用Mockito进行Mock
- 使用AssertJ进行断言
- 使用@MockBean注入Mock对象

**推断的测试数据：**
- 有效用户数据
- 无效用户数据
- 边界值数据
- 异常场景数据

**需要确认的信息：**
1. 测试数据的具体内容？
2. 是否需要性能测试？
3. 是否需要集成测试？
4. 是否需要测试覆盖率检查？

请确认以上信息是否正确，或者提供更多详细信息？
```

## 生成内容

### 1. 测试类定义
- 测试类名以`Test`结尾
- 使用`@ExtendWith(MockitoExtension.class)`
- 包含所有必要的测试用例
- 完整的JavaDoc注释

### 2. 测试用例
- 使用`@Test`注解标记测试方法
- 测试方法名以`test`开头
- 遵循AAA模式（Arrange-Act-Assert）
- 包含边界值和异常测试

### 3. Mock对象
- 使用`@Mock`或`@MockBean`创建Mock对象
- Mock外部依赖和第三方服务
- 设置Mock对象的行为
- 验证Mock对象的交互

### 4. 断言验证
- 使用AssertJ进行流畅断言
- 验证返回值和状态变化
- 验证异常和错误情况
- 验证集合和对象属性

### 5. 测试数据
- 使用Builder模式创建测试数据
- 支持参数化测试
- 使用测试工具类
- 支持测试数据清理

## 标准测试类型

### 1. 单元测试
- `ServiceTest` - 服务层单元测试
- `ControllerTest` - 控制器单元测试
- `MapperTest` - 数据访问层测试
- `UtilTest` - 工具类测试

### 2. 集成测试
- `IntegrationTest` - 集成测试
- `WebMvcTest` - Web层集成测试
- `DataJpaTest` - 数据层集成测试
- `SpringBootTest` - 完整应用测试

### 3. 性能测试
- `PerformanceTest` - 性能测试
- `LoadTest` - 负载测试
- `StressTest` - 压力测试
- `BenchmarkTest` - 基准测试

### 4. 安全测试
- `SecurityTest` - 安全测试
- `AuthenticationTest` - 认证测试
- `AuthorizationTest` - 授权测试
- `ValidationTest` - 校验测试

## 测试类特性
1. **完整性**: 覆盖所有主要功能
2. **独立性**: 每个测试独立运行
3. **可重复**: 相同输入产生相同结果
4. **快速执行**: 单元测试执行时间<100ms
5. **可维护**: 清晰的测试结构和注释

## 技术实现
- **框架**: 使用JUnit 5 + Mockito + AssertJ
- **Mock**: 使用@Mock和@MockBean
- **断言**: 使用AssertJ流畅断言
- **数据**: 使用Builder模式和测试工具类
- **配置**: 使用@TestConfiguration

## 注意事项
1. AI会根据描述自动推断测试用例
2. 自动处理Mock对象和测试数据
3. 包含完整的断言验证
4. 遵循项目的编码规范和测试规范
5. 生成的代码可以直接运行和测试
6. 支持多轮对话完善需求
7. 支持文档引用和智能推断
8. 支持自然语言描述

## 最佳实践建议

### 1. 描述技巧
- **具体描述**: 提供详细的测试需求描述，AI能更好地理解需求
- **关键测试**: 包含核心功能测试，帮助AI生成准确代码
- **测试场景**: 指定测试场景和边界条件

### 2. 交互技巧
- **分步确认**: 先确认核心测试，再完善测试细节
- **及时反馈**: 对AI的推断及时提供反馈
- **迭代优化**: 基于生成结果进行迭代优化

### 3. 文档使用
- **测试文档**: 在项目中维护测试文档，AI会自动发现
- **规范文档**: 维护测试规范文档，AI会参考生成测试
- **业务文档**: 维护业务文档，AI会参考生成测试用例